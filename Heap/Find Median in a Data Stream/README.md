**Find Median in a Data Stream**
-

ğŸ”— Link: Find Median in a Data Stream

ğŸ’¡ Difficulty: Hard

ğŸ› ï¸ Topics: Heap (å †)ã€Two Heaps (é›™å †çµæ§‹)ã€Data Stream (è³‡æ–™æµ)ã€Priority Queue (å„ªå…ˆä½‡åˆ—)ã€Dynamic Data Structures (å‹•æ…‹æ•¸æ“šçµæ§‹)ã€Time Complexity (æ™‚é–“è¤‡é›œåº¦)ã€

 Space Complexity(ç©ºé–“è¤‡é›œåº¦)

é€™äº›è§€å¿µåæ˜ å‡ºé¡Œç›®è¨­è¨ˆçš„æ ¸å¿ƒï¼šå¦‚ä½•è¨­è¨ˆä¸€å€‹èƒ½æŒçºŒã€é«˜æ•ˆåœ°è™•ç†è³‡æ–™æµçš„æ•¸æ“šçµæ§‹ï¼Œä¸¦åœ¨å‹•æ…‹è®ŠåŒ–ä¸­å¿«é€ŸæŸ¥è©¢é—œéµå€¼ï¼ˆä¸­ä½æ•¸ï¼‰ã€‚

==========================================

The median is the middle value in a sorted list of integers. For lists of even length, there is no middle value, so the median is the mean of the two middle values.

For example:

    ï¼For arr = [1,2,3], the median is 2.
    
    ï¼For arr = [1,2], the median is (1 + 2) / 2 = 1.5

Implement the MedianFinder class:

    ï¼MedianFinder() initializes the MedianFinder object.
    
    ï¼void addNum(int num) adds the integer num from the data stream to the data structure.
    
    ï¼double findMedian() returns the median of all elements so far.

Example 1:

Input:
["MedianFinder", "addNum", "1", "findMedian", "addNum", "3" "findMedian", "addNum", "2", "findMedian"]

Output:
[null, null, 1.0, null, 2.0, null, 2.0]

Explanation:
MedianFinder medianFinder = new MedianFinder();
medianFinder.addNum(1);    // arr = [1]
medianFinder.findMedian(); // return 1.0
medianFinder.addNum(3);    // arr = [1, 3]
medianFinder.findMedian(); // return 2.0
medianFinder.addNum(2);    // arr[1, 2, 3]
medianFinder.findMedian(); // return 2.0

Constraints:

ï¼-100,000 <= num <= 100,000

ï¼findMedian will only be called after adding at least one integer to the data structure.

===========================================
**UMPIRE Method:**

**Understand**

1.æ‰¾å‡ºä¸­ä½æ•¸çš„æ ¸å¿ƒï¼š

  ï¼ä¸­ä½æ•¸ æ˜¯æœ‰åºæ•¸åˆ—çš„ä¸­é–“å€¼ï¼š

    ï¼å¦‚æœæ•¸åˆ—é•·åº¦ç‚ºå¥‡æ•¸ï¼Œè¿”å›ä¸­é–“çš„æ•¸ã€‚
    
    ï¼å¦‚æœæ•¸åˆ—é•·åº¦ç‚ºå¶æ•¸ï¼Œè¿”å›ä¸­é–“å…©æ•¸çš„å¹³å‡å€¼ã€‚

  ï¼å‹•æ…‹æ•¸æ“šæµçš„ç‰¹é»ï¼šæ•¸æ“šæœƒä¸æ–·æ–°å¢ï¼Œå¿…é ˆæ”¯æŒé«˜æ•ˆçš„æ’å…¥èˆ‡ä¸­ä½æ•¸è¨ˆç®—ã€‚

2.åŠŸèƒ½èªªæ˜ï¼š

  ï¼MedianFinder(): åˆå§‹åŒ–æ•¸æ“šçµæ§‹ã€‚
  
  ï¼addNum(int num): æ’å…¥ä¸€å€‹æ•´æ•¸ num åˆ°æ•¸æ“šæµä¸­ã€‚
  
  ï¼findMedian(): è¨ˆç®—ä¸¦è¿”å›ç•¶å‰æ•¸æ“šæµçš„ä¸­ä½æ•¸ã€‚

3.ç›®æ¨™ï¼šåœ¨ é«˜æ•ˆæ€§ï¼ˆæ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦ï¼‰ å’Œ æ­£ç¢ºæ€§ï¼ˆç¶­è­·æ’åºï¼‰ ä¹‹é–“å–å¾—å¹³è¡¡ã€‚

**Match**

å¯ä»¥è€ƒæ…®çš„è§£æ³•ï¼š

1.æš´åŠ›æ³•ï¼š

    ï¼ä½¿ç”¨åˆ—è¡¨å­˜å„²æ•¸æ“šï¼Œæ¯æ¬¡æ’å…¥å¾Œæ’åºã€‚
    
    ï¼è¨ˆç®—ä¸­ä½æ•¸æ™‚ç›´æ¥ç²å–ä¸­é–“å…ƒç´ æˆ–å¹³å‡å€¼ã€‚
    
    ï¼ç¼ºé»ï¼šæ’å…¥æ“ä½œæ•ˆç‡ä½ï¼Œæ’åºç‚º O(nlogn)ã€‚

2.å„ªåŒ–æ³•ï¼š

ï¼ä½¿ç”¨ å…©å€‹å †ï¼ˆHeapsï¼‰ï¼š
  
  ï¼æœ€å¤§å † lowï¼šå­˜å„²æ•¸æ“šæµä¸­è¼ƒå°çš„ä¸€åŠã€‚
  
  ï¼æœ€å°å † highï¼šå­˜å„²æ•¸æ“šæµä¸­è¼ƒå¤§çš„ä¸€åŠã€‚
  
  ï¼ä¿æŒå…©å€‹å †çš„å¹³è¡¡ï¼š

    ï¼æœ€å¤§å †å…ƒç´ æ•¸é‡ â‰¥ æœ€å°å †ã€‚
    
    ï¼ä¸­ä½æ•¸ç”±å †é ‚å…ƒç´ ç›´æ¥è¨ˆç®—ã€‚

  ï¼æ’å…¥èˆ‡è¨ˆç®—ä¸­ä½æ•¸çš„æ™‚é–“è¤‡é›œåº¦ç‚º O(logn)ã€‚

**Plan**

1.åˆå§‹åŒ–ï¼š

    ï¼ä½¿ç”¨ heapq æ¨¡æ“¬æœ€å¤§å †ï¼ˆå–è² å€¼å­˜å…¥ï¼‰ã€‚
    
    ï¼åˆå§‹åŒ–å…©å€‹å † low å’Œ highã€‚

2.æ’å…¥æ•¸æ“šï¼š

    ï¼æ’å…¥ num æ™‚ï¼Œå…ˆæ”¾å…¥ lowï¼ˆæœ€å¤§å †ï¼‰ã€‚
    
    ï¼å†å°‡ low çš„å †é ‚ç§»å…¥ highï¼ˆæœ€å°å †ï¼‰ï¼Œç¶­æŒæ’åºã€‚
    
    ï¼æœ€å¾Œå¹³è¡¡å…©å€‹å †çš„å¤§å°ã€‚

3.è¨ˆç®—ä¸­ä½æ•¸ï¼š

    ï¼å¦‚æœ low çš„å¤§å°å¤§æ–¼ highï¼Œè¿”å› low çš„å †é ‚ã€‚
    
    ï¼å¦å‰‡è¿”å›å…©å€‹å †é ‚çš„å¹³å‡å€¼ã€‚

**Implement**

see solution.py

**Review**

1.åˆå§‹åŒ–ï¼š

    ï¼æœ€å¤§å †å’Œæœ€å°å †éƒ½æ­£ç¢ºåˆå§‹åŒ–ã€‚
    
    ï¼ç¶­è­·å…©å€‹å †çš„å¹³è¡¡æ€§ã€‚

2.æ’å…¥æ“ä½œï¼š
    
    ï¼æ’å…¥å¾Œç¢ºä¿æœ€å¤§å †çš„å †é ‚å§‹çµ‚å°æ–¼æœ€å°å †çš„å †é ‚ã€‚
    
    ï¼ä¿è­‰å…©å€‹å †çš„å¤§å°å·®ä¸è¶…é 1ã€‚

3.è¨ˆç®—ä¸­ä½æ•¸ï¼š

    ï¼æœ€å¤§å †æ¯”æœ€å°å †å¤šä¸€å€‹å…ƒç´ æ™‚ï¼Œç›´æ¥è¿”å›æœ€å¤§å †å †é ‚ã€‚
    
    ï¼å †å¤§å°ç›¸ç­‰æ™‚ï¼Œè¨ˆç®—å…©å †å †é ‚çš„å¹³å‡å€¼ã€‚

**Evaluate**

ï¼æ™‚é–“è¤‡é›œåº¦ï¼š

    ï¼æ’å…¥æ•¸æ“šï¼šO(logn)ï¼Œå› ç‚ºå †æ“ä½œéœ€è¦ O(logn) æ™‚é–“ã€‚
    
    ï¼æŸ¥è©¢ä¸­ä½æ•¸ï¼šO(1)ï¼Œå› ç‚ºå †é ‚å…ƒç´ å¯ç›´æ¥è¨ªå•ã€‚

ï¼ç©ºé–“è¤‡é›œåº¦ï¼šO(n)ï¼Œéœ€è¦å­˜å„²æ‰€æœ‰æ•¸æ“šæ–¼å…©å€‹å †ä¸­ã€‚

**å…·é«”æ­¥é©Ÿæ‹†è§£**

1. åˆå§‹åŒ–

ï¼ä½¿ç”¨ heapq å»ºç«‹å…©å€‹å †ï¼š

    ï¼æœ€å¤§å † low å­˜æ”¾è² æ•¸ï¼Œå¯¦ç¾å¾å¤§åˆ°å°çš„æ’åºã€‚
    
    ï¼æœ€å°å † high å­˜æ”¾æ­£æ•¸ï¼Œå¯¦ç¾å¾å°åˆ°å¤§çš„æ’åºã€‚

2. æ’å…¥æ•¸æ“šçš„é‚è¼¯

æ¯æ¬¡æ’å…¥ä¸€å€‹æ–°æ•¸æ“š num æ™‚ï¼š

1.Step 1ï¼šå…ˆæ”¾å…¥æœ€å¤§å † lowï¼ˆæš«æ™‚è™•ç†æ‰€æœ‰æ–°æ•¸æ“šï¼‰

    ï¼æˆ‘å€‘å°‡æ–°æ•¸æ“šçš„è² æ•¸åŠ å…¥æœ€å¤§å †ï¼ˆå› ç‚º heapq åªæ”¯æŒæœ€å°å †ï¼ŒåŠ å…¥è² æ•¸æ¨¡æ“¬æœ€å¤§å †ï¼‰ã€‚
    
    ï¼é€™æ¨£ä¿è­‰äº† low çš„å †é ‚æ˜¯ã€Œç›®å‰è¼ƒå°æ•¸æ“šçš„ä¸€éƒ¨åˆ†ä¸­çš„æœ€å¤§å€¼ã€ã€‚

ä¾‹å­ï¼š

  ï¼æ’å…¥æ•¸æ“š 3ï¼Œæœ€å¤§å †è®Šç‚º [-3]ã€‚

2.Step 2ï¼šå°‡æœ€å¤§å †çš„å †é ‚ç§»åˆ°æœ€å°å †

    ï¼å› ç‚ºæ–°çš„æ•¸æ“šå…ˆåŠ å…¥äº†æœ€å¤§å †ï¼Œæœ€å¤§å †çš„å †é ‚å¯èƒ½æ¯”æœ€å°å †çš„å †é ‚å¤§ï¼Œé€™æœƒç ´å£å…©å †çš„é †åºã€‚
    
    ï¼æ‰€ä»¥æˆ‘å€‘å–å‡ºæœ€å¤§å †çš„å †é ‚ï¼ˆæ³¨æ„æ˜¯è² æ•¸çš„ç›¸åå€¼ï¼‰ï¼Œæ”¾å…¥æœ€å°å †ï¼Œç¢ºä¿å…©å †çš„æ•¸æ“šæ˜¯æŒ‰é †åºæ’åˆ—çš„ã€‚

ä¾‹å­ï¼š

    ï¼æ’å…¥æ•¸æ“š 3ï¼Œæœ€å¤§å †ç‚º [-3]ï¼Œæœ€å°å †ç‚ºç©ºã€‚
    
    ï¼å°‡ -(-3) åŠ å…¥æœ€å°å †å¾Œï¼š

      ï¼æœ€å¤§å †è®Šç‚ºç©ºï¼Œæœ€å°å †è®Šç‚º [3]ã€‚

3.Step 3ï¼šå¹³è¡¡å…©å€‹å †çš„å¤§å°

    ï¼å¦‚æœæœ€å°å †çš„å¤§å°è¶…éæœ€å¤§å †ï¼Œå°‡æœ€å°å †çš„å †é ‚ç§»å›æœ€å¤§å †ã€‚
    
    ï¼ä¿è­‰å…©å †å¤§å°ç›¸å·®ä¸è¶…é 1ã€‚

ä¾‹å­ï¼š

    ï¼æ’å…¥æ•¸æ“š 5ï¼š

      ï¼æœ€å¤§å †ç‚º [-3]ï¼Œæœ€å°å †ç‚º [5]ã€‚
      
      ï¼å¹³è¡¡å¾Œï¼Œæœ€å¤§å †ç‚º [-3]ï¼Œæœ€å°å †ç‚º [5]ï¼ˆå¤§å°å·²å¹³è¡¡ï¼‰ã€‚

3. è¨ˆç®—ä¸­ä½æ•¸çš„é‚è¼¯

ï¼æœ€å¤§å †å’Œæœ€å°å †å¤§å°å¯èƒ½æœ‰ä»¥ä¸‹å…©ç¨®æƒ…æ³ï¼š

    1.æœ€å¤§å †æ¯”æœ€å°å †å¤š 1 å€‹å…ƒç´ ï¼ˆå¥‡æ•¸æƒ…æ³ï¼‰ï¼š

      ï¼ä¸­ä½æ•¸æ˜¯æœ€å¤§å †çš„å †é ‚ï¼Œå³ã€Œè¼ƒå°æ•¸æ“šçš„ä¸€åŠä¸­æœ€å¤§çš„å€¼ã€ã€‚

    2.å…©å€‹å †å¤§å°ç›¸ç­‰ï¼ˆå¶æ•¸æƒ…æ³ï¼‰ï¼š

      ï¼ä¸­ä½æ•¸æ˜¯å…©å€‹å †å †é ‚çš„å¹³å‡å€¼ã€‚

ä¾‹å­ï¼š

1.æ•¸æ“šæµ [1, 2, 3]ï¼š

    ï¼æœ€å¤§å † [-2, -1]ï¼Œæœ€å°å † [3]ã€‚
    
    ï¼ä¸­ä½æ•¸ç‚º 2ï¼ˆæœ€å¤§å †å †é ‚ï¼‰ã€‚

2.æ•¸æ“šæµ [1, 2, 3, 4]ï¼š

    ï¼æœ€å¤§å † [-2, -1]ï¼Œæœ€å°å † [3, 4]ã€‚
    
    ï¼ä¸­ä½æ•¸ç‚º (2 + 3) / 2 = 2.5ã€‚

**æ ¸å¿ƒé‚è¼¯ç¸½çµ**

1.ç”¨å…©å€‹å †åˆ†æ²»æ•¸æ“šæµï¼š

    ï¼æœ€å¤§å †å­˜æ”¾ã€Œè¼ƒå°çš„ä¸€åŠã€ï¼Œæœ€å°å †å­˜æ”¾ã€Œè¼ƒå¤§çš„ä¸€åŠã€ã€‚

2.ä¿æŒå…©å€‹å †çš„å¹³è¡¡æ€§ï¼š

    ï¼å…©å€‹å †çš„å¤§å°ç›¸å·®ä¸è¶…é 1ã€‚

3.é«˜æ•ˆè¨ˆç®—ä¸­ä½æ•¸ï¼š

    ï¼æ ¹æ“šå †é ‚å…ƒç´ ç›´æ¥å¾—å‡ºä¸­ä½æ•¸ï¼Œç„¡éœ€æ’åºã€‚

é€™æ¨£ï¼Œæˆ‘å€‘èƒ½ä»¥ O(log n) æ’å…¥æ•¸æ“šï¼Œä¸¦ä»¥ O(1) è¨ˆç®—ä¸­ä½æ•¸ï¼

**ç‚ºä»€éº¼è¦ç”¨è² æ•¸æ¨¡æ“¬æœ€å¤§å †ï¼Ÿ**

Python çš„ heapq æ˜¯ æœ€å°å † çš„å¯¦ç¾ï¼Œä¸»è¦ç”¨æ–¼å¿«é€Ÿå–å‡ºæœ€å°å€¼ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›å ´æ™¯ä¸­éœ€è¦ æœ€å¤§å †ï¼ˆå¿«é€Ÿå–æœ€å¤§å€¼ï¼‰ã€‚ç‚ºäº†é¿å…é‡å¯«å †çš„é‚è¼¯ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ æ•¸å­—å–è²  çš„æŠ€å·§ä¾†æ¨¡æ“¬æœ€å¤§å †ã€‚

ä»¥ä¸‹æ˜¯åŸå› èˆ‡è©³ç´°è§£é‡‹ï¼š

1.heapq çš„ç‰¹æ€§ï¼š

    ï¼heapq é»˜èªæ˜¯æœ€å°å †ï¼Œå †é ‚å…ƒç´ æ˜¯å †ä¸­æœ€å°çš„æ•¸å€¼ã€‚
    
    ï¼å¦‚æœæˆ‘å€‘ç›´æ¥ä½¿ç”¨æœ€å°å †ï¼Œåªèƒ½å¿«é€Ÿç²å–æœ€å°å€¼ï¼Œç„¡æ³•å¿«é€Ÿç²å–æœ€å¤§å€¼ã€‚

2.æ•¸å­—å–è² çš„æ•ˆæœï¼š

    ï¼å‡è¨­æ•¸åˆ—ç‚º [3, 1, 5]ï¼Œå¦‚æœç›´æ¥å­˜å…¥ heapqï¼Œæœ€å°å€¼æ˜¯ 1ã€‚
    
    ï¼å¦‚æœæ”¹å­˜å–è² å¾Œçš„å€¼ [-3, -1, -5]ï¼š

        ï¼è² æ•¸ä¸­æœ€å°å€¼æ˜¯ -5ï¼Œå®ƒå°æ‡‰çš„åŸå§‹æ•¸å€¼å…¶å¯¦æ˜¯ 5ï¼ˆæœ€å¤§å€¼ï¼‰ã€‚
        
        ï¼å–å †é ‚å…ƒç´ æ™‚å†è½‰å›æ­£æ•¸ï¼ˆå³å–è² æ•¸çš„ç›¸åå€¼ï¼‰ï¼Œå³å¯å¾—åˆ°æœ€å¤§å€¼ã€‚

3.é¿å…é‡æ–°å¯¦ç¾å †ï¼š

    ï¼heapq æ˜¯é«˜æ•ˆçš„å †å¯¦ç¾ï¼ˆåŸºæ–¼äºŒå‰å †ï¼‰ï¼Œç›´æ¥ä½¿ç”¨å®ƒæ¯”é‡æ–°è¨­è¨ˆå’Œå¯¦ç¾ä¸€å€‹æœ€å¤§å †æ›´ç°¡å–®å’Œé«˜æ•ˆã€‚

4.ç¯€çœæ™‚é–“èˆ‡ç©ºé–“ï¼š

    ï¼ä½¿ç”¨æ•¸å­—å–è² çš„æŠ€å·§ï¼Œåªéœ€åœ¨å­˜å–å †å…ƒç´ æ™‚ç¨ä½œè™•ç†ï¼Œé‹è¡Œæ•ˆç‡èˆ‡ç›´æ¥æ“ä½œæœ€å¤§å †å¹¾ä¹ä¸€è‡´ã€‚
    
    ï¼é¿å…å¢åŠ é¡å¤–çš„æ•¸æ“šçµæ§‹æˆ–è¤‡é›œçš„ä»£ç¢¼é‚è¼¯ã€‚

**æ¨¡æ“¬æœ€å¤§å †çš„å…·é«”æ“ä½œ**

å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹æ•¸çµ„ [3, 1, 5]ï¼Œä¸¦å¸Œæœ›ç”¨ heapq æ¨¡æ“¬æœ€å¤§å †ï¼š

1.æ’å…¥æ•¸å­—ï¼ˆå–è² æ•¸ï¼‰ï¼š

    ï¼æ’å…¥ 3ï¼šå­˜ -3ï¼Œå †ç‚º [-3]ã€‚
    
    ï¼æ’å…¥ 1ï¼šå­˜ -1ï¼Œå †ç‚º [-3, -1]ï¼ˆå †é ‚ç‚ºæœ€å¤§å€¼çš„è² æ•¸ -3ï¼‰ã€‚
    
    ï¼æ’å…¥ 5ï¼šå­˜ -5ï¼Œå †ç‚º [-5, -1, -3]ï¼ˆå †é ‚ç‚ºæœ€å¤§å€¼çš„è² æ•¸ -5ï¼‰ã€‚

2.å–å‡ºæœ€å¤§å€¼ï¼š

    ï¼å–å †é ‚å…ƒç´ ï¼š-5ã€‚
    
    ï¼è½‰å›æ­£æ•¸ï¼š5ï¼ˆå³åŸå§‹æ•¸æ“šä¸­çš„æœ€å¤§å€¼ï¼‰ã€‚

3.å †çš„è®ŠåŒ–éç¨‹ï¼š

    ï¼æ’å…¥é †åºï¼š3 â†’ 1 â†’ 5ã€‚
    
    ï¼å †å…§éƒ¨çµæ§‹ï¼ˆè² æ•¸å½¢å¼ï¼‰ï¼š[-3] â†’ [-3, -1] â†’ [-5, -1, -3]ã€‚
    
    ï¼å°æ‡‰çš„åŸå§‹æ•¸æ“šï¼ˆæ­£æ•¸å½¢å¼ï¼‰ï¼š[3] â†’ [3, 1] â†’ [5, 1, 3]ã€‚

 **ç¸½çµ**

- `heapq` é»˜èªæ”¯æŒæœ€å°å †ï¼Œä½¿ç”¨è² æ•¸æ¨¡æ“¬æœ€å¤§å †ï¼Œæ˜¯ç‚ºäº†ï¼š

  1. åˆ©ç”¨ç¾æœ‰çš„é«˜æ•ˆå¯¦ç¾ã€‚

  2. é¿å…å¢åŠ é¡å¤–çš„é‚è¼¯è¤‡é›œåº¦ã€‚

- åœ¨å­˜å…¥æ•¸å­—æ™‚å–è² æ•¸ï¼Œå–å‡ºæ™‚å†è½‰å›æ­£æ•¸å³å¯å¯¦ç¾æœ€å¤§å †åŠŸèƒ½ã€‚

- é€™æ˜¯ä¸€ç¨®ç°¡å–®é«˜æ•ˆçš„è§£æ±ºæ–¹æ¡ˆï¼Œå¸¸è¦‹æ–¼éœ€è¦åŒæ™‚æ“ä½œæœ€å°å †èˆ‡æœ€å¤§å †çš„å ´æ™¯ï¼ˆå¦‚ä¸­ä½æ•¸æ•¸æ“šæµå•é¡Œï¼‰ã€‚

